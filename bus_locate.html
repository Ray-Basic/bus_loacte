<!DOCTYPE html>
<html lang="ko">

<head>
	<meta charset="UTF-8">
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
	<header Permissions-Policy: interest-cohort=()></header>
	<title>XML Xpath</title>
	<script>
		function loadDoc() {
			var xmlHttp = new XMLHttpRequest();
			xmlHttp.onreadystatechange = function() {
				if(this.status == 200 && this.readyState == this.DONE) {
					findResult(xmlHttp);
				}
			};
			xmlHttp.open("GET", "http://openapi.tago.go.kr/openapi/service/BusLcInfoInqireService/getRouteAcctoBusLcList?ServiceKey=NJPq5bgNwTn08ylVVjGuBpmtiwARPqc%2BUR4WPrIf5advbjU9WA1RrL1SIMjKUNhRHh2fKE8QOVUpf6%2FBu9lCpA%3D%3D&cityCode=33020&routeId=CHB272000377", true);
			xmlHttp.setRequestHeader("Access-Control-Allow-Origin", "http://*");
			xmlHttp.send(); //API URL을 https로 변경하면 저 URL이 로드가 안된다.
		}

		function findResult(xmlHttp) {
			var xmlObj, path, result, nodeList, node;
			xmlObj = xmlHttp.responseXML;
			path = "//nodenm"; 
			result = "";
		
			// 익스플로러를 위한 코드
			if (window.ActiveXObject !== undefined || xmlHttp.responseType == "msxml-document") {
				xmlObj.setProperty("SelectionLanguage", "XPath");
				nodeList = xmlObj.selectNodes(path);

				for (i=0; i<nodeList.length; i++) {
					result += nodeList[i].text + "<br>";
				}
			// 익스플로러를 제외한 브라우저를 위한 코드
			} else if (document.implementation && document.implementation.createDocument) {
				nodeList = xmlObj.evaluate(path, xmlObj, null, XPathResult.ANY_TYPE, null);
				node = nodeList.iterateNext();

				while (node) {
					result += node.firstChild.nodeValue + "<br>";
					node = nodeList.iterateNext();
				}
			}
			
			document.getElementById("text").innerHTML = result;
		}
	</script>
</head>
<body>

	<h1></h1>
	<button onclick="loadDoc()">정류장 위치 확인!</button>
	<p id="text"></p>
	
</body>

</html>
